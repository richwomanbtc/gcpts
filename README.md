# GCP time series
<!-- Pytest Coverage Comment:Begin -->
<a href="https://github.com/richwomanbtc/gcpts/blob/main/README.md"><img alt="Coverage" src="https://img.shields.io/badge/Coverage-36%25-red.svg" /></a><details><summary>Coverage Report </summary><table><tr><th>File</th><th>Stmts</th><th>Miss</th><th>Cover</th><th>Missing</th></tr><tbody><tr><td colspan="5"><b>gcpts</b></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/dt.py">dt.py</a></td><td>46</td><td>36</td><td>22%</td><td><a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/dt.py#L6-L10">6&ndash;10</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/dt.py#L14">14</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/dt.py#L18">18</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/dt.py#L22">22</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/dt.py#L27-L36">27&ndash;36</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/dt.py#L40">40</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/dt.py#L50-L62">50&ndash;62</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/dt.py#L66-L82">66&ndash;82</a></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/uploader.py">uploader.py</a></td><td>26</td><td>18</td><td>31%</td><td><a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/uploader.py#L14-L48">14&ndash;48</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/uploader.py#L58">58</a></td></tr><tr><td colspan="5"><b>gcpts/sql</b></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/sql/basic.py">basic.py</a></td><td>42</td><td>35</td><td>17%</td><td><a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/sql/basic.py#L23-L56">23&ndash;56</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/sql/basic.py#L71-L93">71&ndash;93</a></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/sql/resample.py">resample.py</a></td><td>121</td><td>69</td><td>43%</td><td><a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/sql/resample.py#L17">17</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/sql/resample.py#L25">25</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/sql/resample.py#L33">33</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/sql/resample.py#L42-L43">42&ndash;43</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/sql/resample.py#L52-L53">52&ndash;53</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/sql/resample.py#L62-L63">62&ndash;63</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/sql/resample.py#L72-L73">72&ndash;73</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/sql/resample.py#L82-L83">82&ndash;83</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/sql/resample.py#L92-L100">92&ndash;100</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/sql/resample.py#L119-L170">119&ndash;170</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/sql/resample.py#L185-L227">185&ndash;227</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/gcpts/sql/resample.py#L248-L253">248&ndash;253</a></td></tr><tr><td colspan="5"><b>tests</b></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/richwomanbtc/gcpts/blob/main/tests/test_gcpts.py">test_gcpts.py</a></td><td>80</td><td>53</td><td>34%</td><td><a href="https://github.com/richwomanbtc/gcpts/blob/main/tests/test_gcpts.py#L19-L23">19&ndash;23</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/tests/test_gcpts.py#L28">28</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/tests/test_gcpts.py#L33-L39">33&ndash;39</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/tests/test_gcpts.py#L44-L52">44&ndash;52</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/tests/test_gcpts.py#L57-L66">57&ndash;66</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/tests/test_gcpts.py#L71-L93">71&ndash;93</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/tests/test_gcpts.py#L106-L129">106&ndash;129</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/tests/test_gcpts.py#L143-L157">143&ndash;157</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/tests/test_gcpts.py#L170-L199">170&ndash;199</a>, <a href="https://github.com/richwomanbtc/gcpts/blob/main/tests/test_gcpts.py#L203-L224">203&ndash;224</a></td></tr><tr><td><b>TOTAL</b></td><td><b>330</b></td><td><b>211</b></td><td><b>36%</b></td><td>&nbsp;</td></tr></tbody></table></details>
<!-- Pytest Coverage Comment:End -->
## Requirements
- Python 3.10+

## Installation
```
pip install git+https://github.com/richwomanbtc/gcpts.git
```

## Test
```
poetry run pytest -s -vv
```

## Usage

```python
import gcpts
import pandas as pd
import numpy as np



gcpts_client = gcpts.GCPTS(
    project_id="example_project", 
    dataset_id="example_dataset"
)

# Prepare example data, your data need to have 3 columns named symbol, dt, partition_dt
df = pd.DataFrame(np.random.randn(5000, 4))

df.columns = ['open', 'high', 'low', 'close']

# symbol represent a group of data for given data columns
df['symbol'] = 'BTCUSDT'

# timestamp should be UTC timezone but without tz info
df['dt'] = pd.date_range('2022-01-01', '2022-05-01', freq='15Min')[:5000]

# partition_dt must be date, data will be updated partition by partition with use of this column.
# Every time, you have to upload all the data for a given partition_dt, otherwise older will be gone.
df['partition_dt'] = df['dt'].dt.date.map(lambda x: x.replace(day=1))

gcpts_client.upload(table_name='example_table', df=df)
```

```python
# Query for raw data.
raw_clsoe = tsdb.query(
    table_name='example_table',
    field='close',
    start_dt='2022-02-01 00:00:00', # yyyy-mm-dd HH:MM:SS, inclusive
    end_dt='2022-02-05 23:59:59', # yyyy-mm-dd HH:MM:SS, inclusive
    symbols=['BTCUSDT'],
)

# Query for raw data with resampling
resampeld_daily_close = tsdb.resample_query(
    table_name='example_table',
    field='close',
    start_dt='2022-01-01 00:00:00', # yyyy-mm-dd HH:MM:SS, inclusive
    end_dt='2022-01-31 23:59:59', # yyyy-mm-dd HH:MM:SS, inclusive
    symbols=['BTCUSDT'],
    interval='day', # month | week | day | hour | {1,2,3,4,6,8,12}hour | minute | {5,15,30}minute
    op='last', # last | first | min | max | sum
)
```

## Disclaimer
This allows you to have SQL injection. Please use it for your own purpose only and do not allow putting arbitrary requests to this library.